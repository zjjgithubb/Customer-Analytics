{
  "hash": "608f3850bb8b4de53b209c2d03b3a237",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Assignment 1\"\n\nauthor: \"Cheng Chun Chieh\"\n\ndate: \"13 May 2024\"\ndate-modified: \"last-modified\"\n\nformat: html\nexecute: \n  echo: true\n  eval: true\n  warning: false\n  freeze: true\n  \neditor: visual\n---\n\n\n# Data Prep\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(ggstatsplot,plotly, patchwork, hrbrthemes, ggridges, ggrepel, tidyverse, ggpubr, scales, colorspace, ggdist, zoo)\n```\n:::\n\n\n## Reading Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read_csv(\"data/ResponderInfo.csv\")\n\ndf2 <- read_csv(\"data/Transactions.csv\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n## Checking Data - Response Values\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf$response_value <- factor(df$response_value)\n\nsummary(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Customer_Number    response_value\n Length:6884        0:6237        \n Class :character   1: 647        \n Mode  :character                 \n```\n\n\n:::\n\n```{.r .cell-code}\nunique_customers <- unique(df$Customer_Number)\n```\n:::\n\n\n## Checking Data - Transaction Values\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique_customers1 <- unique(df2$Customer_Number)\n```\n:::\n\n\nWe have 6889 customers here. and we have 125000 transactions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(df2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Customer_Number     trans_date          tran_value    \n Length:125000      Length:125000      Min.   : 15.00  \n Class :character   Class :character   1st Qu.: 70.50  \n Mode  :character   Mode  :character   Median : 97.50  \n                                       Mean   : 97.49  \n                                       3rd Qu.:124.50  \n                                       Max.   :157.50  \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf2$trans_date <- as.Date(df2$trans_date, format = \"%d-%b-%y\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf3 <- df2\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf3 <- df3 %>%\n  mutate(month_year = format(trans_date, \"%b-%Y\"))\n\n# Group by month and year and count the number of transactions in each month\ndf4 <- df3 %>%\n  group_by(month_year) %>%\n  summarise(num_transactions = n())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndf4$trans_date <- as.Date(paste0(\"01\", sep=\"-\", df4$month_year), format = \"%d-%b-%Y\")\n\ndf4 <- df4 %>%\n  arrange(trans_date)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(df4, aes(x = trans_date, y = num_transactions)) +\n  geom_line() +\n  geom_point() +\n  labs(x = \"Date\", y = \"Number of Transactions\", title = \"Transaction Counts Over Time\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](assignment1_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n## Purchase Pattern by Year for each Customer\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf5 <- df2 %>%\n  mutate(year = format(trans_date, \"%Y\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncustomer_summary_year <- df5 %>%\n  group_by(Customer_Number, year) %>%\n  summarise(num_purchases = n(),\n            avg_purchase = mean(tran_value),\n            total_purchase = sum(tran_value)\n            ) %>%\n  pivot_wider(\n    names_from = year, \n    values_from = c(num_purchases, avg_purchase, total_purchase), \n    names_prefix = \"year_\"\n    ) %>%\n  ungroup()\n\ncustomer_summary_year[is.na(customer_summary_year)] <- 0\n```\n:::\n\n\n## Grouping Data by Customer\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncustomer_summary <- df3 %>%\n  group_by(Customer_Number) %>%\n  summarise(\n    num_transactions = n(),\n    total_value = sum(tran_value, na.rm = TRUE),\n    avg_trans_value = mean(tran_value, na.rm = TRUE),\n    days_last = as.numeric(Sys.Date() - max(trans_date)),\n    days_first = as.numeric(Sys.Date() - min(trans_date))   \n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_df <- left_join(customer_summary, df, by = \"Customer_Number\")\n\n# Replace missing values in the 'response' column with \"Missing\"\ncombined_df$response_value[is.na(combined_df$response_value)] <- \"Missing\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncombined_df <- left_join(combined_df, customer_summary_year, by =\"Customer_Number\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(combined_df, \"combined.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(combined_df, \"data/customer_combined.csv\")\n```\n:::\n",
    "supporting": [
      "assignment1_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}